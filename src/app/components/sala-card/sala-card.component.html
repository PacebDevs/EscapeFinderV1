<ion-card class="sala-card">
  <!-- Mostrar el contenido real solo cuando la imagen se ha cargado completamente -->
  <ng-container *ngIf="!loadingImage; else skeletonTemplate">
    
    <!-- Imagen principal de la sala -->
    <div class="img-wrapper">
      <div class="image-container">
        <img
          [src]="currentImage"
          [attr.loading]="'lazy'"
          (load)="onImageLoad()"
          (error)="onImageError()"
          [class.loaded]="!loadingImage"
          alt="Imagen de la sala"
        />
      </div>
      <!-- Icono de favorito (verde si activo) -->
      <ion-icon
        #favoriteIcon
        [name]="isFavorito ? 'heart' : 'heart-outline'"
        class="favorite-icon"
        (click)="toggleFavorito($event)">
      </ion-icon>
      <!-- Nombre de la sala y ciudad -->
  <div class="nombre-overlay">
    <h2>{{ sala.nombre }}</h2>
    <p class="empresa">{{ sala.empresa }} - <small>{{ sala.ciudad }}</small></p>
    </div>
  </div>
  <!-- Chips informativos agrupados en dos filas -->
  <div class="info-chips-container">
    <!-- Fila Superior: Jugadores, Dificultad, Categor√≠as -->
    <div class="chip-row chip-row-top">
      <div class="chip">
        <ion-icon name="people-outline"></ion-icon>
        <span>{{ sala.jugadores_min }}-{{ sala.jugadores_max }}</span>
      </div>
      <div class="chip">
        <ion-icon name="extension-puzzle-outline"></ion-icon>
        <span>{{ sala.dificultad }}</span>
      </div>
      <div class="chip chip-categorias" *ngIf="sala.categorias && sala.categorias.length > 0">
        <ion-icon name="pricetag-outline"></ion-icon>
        <span>{{ sala.categorias.join(', ') }}</span>
      </div>
    </div>

    <!-- Fila Inferior: Precio y Distancia -->
    <div class="chip-row chip-row-bottom">
      <!-- Chip de Precio -->
      <div class="chip chip-precio" *ngIf="sala.precio_min_pp">
        <ion-icon name="cash-outline"></ion-icon>
        <span>Desde {{ sala.precio_min_pp }}‚Ç¨ por persona</span>
      </div>
      <!-- Chip de Distancia -->
      <div class="chip" *ngIf="sala.distancia_km !== null && sala.distancia_km !== undefined">
        <ion-icon name="navigate-circle-outline"></ion-icon>
        <span>{{ formatDistancia(sala.distancia_km) }}</span>
      </div>
    </div>
  </div>

  <!-- Contenido de la tarjeta -->
  <ion-card-content>
      <p class="descripcion-limitada">
        {{ sala.descripcion || 'Sin descripci√≥n disponible.' }}
      </p>
    </ion-card-content>
  </ng-container>
  <!-- üíÄ SKELETON (s√≥lo se muestra mientras loadingImage === true) -->
  <ng-template #skeletonTemplate>
    <div class="skeleton-wrapper">
      <div class="skeleton-image shimmer"></div>
      <div class="skeleton-lines">
        <div class="shimmer skeleton-line short"></div>
        <div class="shimmer skeleton-line medium"></div>
        <div class="shimmer skeleton-line long"></div>
      </div>
    </div>
  </ng-template>
</ion-card>

